---
title: "TOY_1"
author: "Paula Moreno Blazquez"
date: "Enero 2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## DATA

```{r}
players_L <- paste0("LP",1:10)
players_A <- paste0("AP",1:10)


toy <- data.frame(
  "id_play" = 1:15,
  "season" = c(rep("S2017",15)),
  "game" = c(rep("G1",10), rep("G2",5)),
  "points_L" = c(0,0,0,2,2,2,5,5,7,7,7,7,10,10,12),
  "points_A" = c(0,2,2,2,4,4,7,7,9,9,10,10,12,12,12),
  "LP1" = c(rep(players_L[1],4),rep(players_L[6],5),rep(players_L[1],6)),
  "LP2" = players_L[2],
  "LP3" = c(rep(players_L[3],7), rep(players_L[7],2),rep(players_L[3],6)),
  "AP1" = players_A[1],
  "AP2" = c(rep(players_A[2],8),players_A[7], rep(players_A[2],6)),
  "AP3" = players_A[3]
  )

toy2 <- data.frame(                         #DF2 para comprovar que funciona
  "id_play" = 1:20,
  "season" = c(rep("S2017",20)),
  "game" = c(rep("G1",10), rep("G2",10)),
  "points_L" = c(0,0,0,2,2,2,5,5,7,7,0,2,2,5,5,7,7,7,9,10),
  "points_A" = c(0,2,2,2,4,4,7,7,9,9,0,0,2,2,4,4,6,6,6,6),
  "LP1" = c(rep(players_L[1],4),rep(players_L[6],5),rep(players_L[1],8), rep(players_L[1],3)),
  "LP2" = players_L[2],
  "LP3" = c(rep(players_L[3],7), rep(players_L[7],2),rep(players_L[3],9), rep(players_L[9],2)),
  "AP1" = players_A[1],
  "AP2" = c(rep(players_A[2],8),players_A[7], rep(players_A[2],9), rep(players_A[5],2)),
  "AP3" = players_A[3]
  )


toy_backup <- toy

df <- toy2

df$PM <- df$points_L-df$points_A

knitr::kable(df)

```

## ORDENAR DF

```{r}
players_pbp <- df[6:11] #subset de solo jugadores pbp
resto_pbp <- cbind(df[1:5], df[12])

## Ordenar alfabeticamente jugadores
order_players_pbp <- lapply(1:nrow(players_pbp), function(row) 
                     players_pbp[row, order(players_pbp[row, ], decreasing = TRUE)])
df_order_players_pbp <- data.frame(matrix(unlist(order_players_pbp), 
                        nrow=length(order_players_pbp), byrow=TRUE))
names(df_order_players_pbp) <- c(paste0("LP",1:3), paste0("AP",1:3))

df_new <- cbind(resto_pbp, df_order_players_pbp)

## Ordernar Columnas
col_order <- c("season", "game", "id_play", "points_L", "points_A", "PM", 
               paste0("LP",1:3), paste0("AP",1:3))
df_order <- df_new[, col_order]
knitr::kable(df_order)
```

## MERGE Jugadores y Temporada+Game

```{r}
library(tidyr)
df_order <- df_order %>% 
  unite("Merged_Players", LP1:AP3, remove = TRUE) %>% 
  unite("Merged_SG", c("season", "game"))

knitr::kable(df_order)
```

## UNIQUE quintetos

```{r}
library(dplyr)
players_Merged <- df_order$Merged_Players == lag(df_order$Merged_Players) 
                                            ## col_TrueFalse si son igual que lag row
SG_DIF <- df_order$Merged_SG == lag(df_order$Merged_SG)   

df_order$TF_Cambios <- ifelse(((players_Merged == FALSE)|(SG_DIF == FALSE )), "C", "NC")

df_order
```

Hasta aquí tenemos detectados cuando hay cambios

## STINTS

```{r}
df_order$stint <- ifelse(lead(df_order$TF)=="C", df_order$TF, NA) 
                                                #Filas que tenemos que conservar

last_row <- tail(df_order, n =1)             #Tendremos que añadirla al final.
last_row$stint <- "LastRow"

knitr::kable(df_order)

library(tidyr)
STINTS <- df_order %>% drop_na(stint)
STINTS <- rbind(STINTS, last_row)
knitr::kable(STINTS[1:6])

dim(STINTS)
```

